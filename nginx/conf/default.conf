proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=STATIC:10m inactive=7d use_temp_path=off;

upstream nestjs_upstream {
  server nestjs:3000 max_fails=1 fail_timeout=5s;
}

server {
  listen 80 default_server;
  server_name _;

  return 301 https://$server_name$request_uri;
}


server {
    listen 443 ssl;
    server_name _;

    ssl_certificate /etc/nginx/wildcard_cert.crt;
    ssl_certificate_key /etc/nginx/private_wildcard.key;

    include includes/security.conf;
    include includes/gzip.conf;
    include includes/proxy.conf;
    include includes/bots.conf;

    location / {
      proxy_pass http://nestjs_upstream;
    }
}


